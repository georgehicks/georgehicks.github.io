<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Focus Timers</title>
  <link rel="manifest" href="/FocusTimers/manifest.webmanifest">
  <meta name="theme-color" content="#a1c4fd">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #f9f9f9;
      color: #333;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    .notes-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background-color: #fff;
      border-bottom: 1px solid #ddd;
      padding: 10px 20px;
      box-sizing: border-box;
      z-index: 10;
    }
    .notes-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 5px;
    }
    .notes {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 8px;
      min-height: 150px;
      max-height: 150px;
      overflow-y: auto;
      background-color: #fafafa;
      font-size: 14px;
    }
    .add-timer-form {
      max-width: 400px;
      width: 100%;
      display: flex;
      margin-bottom: 15px;
      gap: 10px;
    }
    .add-timer-form input {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    .add-timer-form button {
      padding: 8px 12px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
    }
    .add-timer-form button:hover {
      background-color: #218838;
    }
    .timers-container {
      display: flex;
      flex-direction: column;
      max-width: 400px;
      width: 100%;
    }
    .timer-panel {
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 10px;
      transition: opacity 0.3s;
      display: flex;
      align-items: center;
      gap: 15px;
      position: relative;
      cursor: grab;
    }
    .timer-panel.inactive {
      opacity: 0.3;
    }
    .timer-panel.dragging {
      opacity: 0.4;
      cursor: grabbing;
    }
    .drag-over-top::before {
      content: '';
      position: absolute;
      top: -4px;
      left: 0;
      right: 0;
      height: 4px;
      background-color: #007bff;
      border-radius: 2px;
    }
    .drag-over-bottom::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 0;
      right: 0;
      height: 4px;
      background-color: #007bff;
      border-radius: 2px;
    }
    .timer-right {
      display: flex;
      flex-direction: column;
      flex: 1;
    }
    .timer-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 5px;
    }
    .goals {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }
    .goals input {
      width: 60px;
      padding: 4px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-right: 5px;
      text-align: right;
      font-size: 12px;
    }
    .play-btn, .remove-btn {
      cursor: pointer;
    }
    .play-btn {
      padding: 8px;
      background-color: #a1c4fd;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      width: 100%;
    }
    .play-btn:hover {
      background-color: #81a9e0;
    }
    .remove-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: #ff5c5c;
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 12px;
      line-height: 20px;
      text-align: center;
      font-weight: bold;
      z-index: 5;
    }
    .remove-btn:hover {
      background: #e04a4a;
    }
    .thumbs {
      display: flex;
      gap: 10px;
      margin-top: 5px;
    }
    .thumbs button {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 3px;
      padding: 4px;
      border-radius: 4px;
    }
    .thumbs button:hover {
      background-color: #f0f0f0;
    }
    .thumbs .count {
      font-size: 12px;
      font-weight: bold;
      color: #666;
    }
    .radial-progress {
      width: 100px;
      height: 100px;
      position: relative;
      display: none;
      flex-shrink: 0;
    }
    .radial-progress .circle {
      width: 100%;
      height: 100%;
      background: conic-gradient(#eee 0%, #eee 100%);
      border-radius: 50%;
    }
    .radial-progress .mask {
      position: absolute;
      top: 10%;
      left: 10%;
      width: 80%;
      height: 80%;
      background-color: #fff;
      border-radius: 50%;
    }
    .radial-progress .time {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 12px;
      text-align: center;
      font-weight: 700;
      color: black;
      text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;
    }
    @media (max-width: 400px) {
      body {
        padding: 10px;
      }
      .notes {
        min-height: 100px;
        max-height: 100px;
      }
      .radial-progress {
        width: 80px;
        height: 80px;
      }
      .radial-progress .time {
        font-size: 10px;
      }
      .timer-title {
        font-size: 14px;
      }
      .goals input {
        width: 50px;
        font-size: 10px;
      }
      .play-btn {
        font-size: 12px;
        padding: 6px;
      }
      .thumbs {
        gap: 5px;
      }
      .thumbs button {
        font-size: 18px;
        padding: 2px;
      }
    }
  </style>
</head>
<body>
  <div class="notes-container">
    <div class="notes-title">Notes</div>
    <div class="notes" contenteditable="true"></div>
  </div>
  <div class="add-timer-form">
    <input type="text" id="new-timer-name" placeholder="New Timer Name">
    <button id="add-timer-btn">Add Timer</button>
  </div>
  <div class="timers-container"></div>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/FocusTimers/sw.js');
    }
    let timers = [];
    let currentTimes = {};
    let thumbsUp = {};
    let thumbsDown = {};
    let history = [];
    let currentDate = '';
    let runningType = null;
    let interval = null;
    let notes = {};
    let draggedElement = null;
    let lastActivityTime = Date.now();
    let inactivityPopupShown = false;
    let inactivityModal = null;
    let autoStopInterval = null;
    let sessionStartTime = null;
    function saveTimers() {
      localStorage.setItem('focusTimersList', JSON.stringify(timers));
    }
    function loadTimers() {
      const savedTimers = localStorage.getItem('focusTimersList');
      if (savedTimers && JSON.parse(savedTimers).length > 0) {
        timers = JSON.parse(savedTimers);
      } else {
        timers = ['DeepWork', 'Work', 'Meeting', 'Admin', 'Errands', 'Break'];
        saveTimers();
      }
    }
    function createTimerPanelHTML(type) {
      const safeType = type.replace(/"/g, '&quot;');
      return `
        <div class="timer-panel" data-type="${safeType}">
          <button class="remove-btn" title="Remove Timer">√ó</button>
          <div class="radial-progress">
            <div class="circle"></div>
            <div class="mask"></div>
            <div class="time">00:00:00</div>
          </div>
          <div class="timer-right">
            <div class="timer-title">${safeType}</div>
            <div class="goals">
              <input type="number" min="0" placeholder="Min" class="min-goal">
              <input type="number" min="0" placeholder="Max" class="max-goal">
            </div>
            <button class="play-btn">Play</button>
            <div class="thumbs">
              <button class="thumbs-up" title="Positive Progress">üëç <span class="count">0</span></button>
              <button class="thumbs-down" title="Failed Progress">üëé <span class="count">0</span></button>
            </div>
          </div>
        </div>
      `;
    }
    function renderTimers() {
      const container = document.querySelector('.timers-container');
      container.innerHTML = '';
      timers.forEach(type => {
        const panelHTML = createTimerPanelHTML(type);
        container.insertAdjacentHTML('beforeend', panelHTML);
      });
      attachPanelListeners();
      updateAllDisplays();
      updateAllThumbs();
      updateMargin();
    }
    function attachPanelListeners() {
      document.querySelectorAll('.timer-panel').forEach(panel => {
        const type = panel.dataset.type;
        panel.setAttribute('draggable', 'true');
        panel.addEventListener('dragstart', handleDragStart);
        panel.addEventListener('dragend', handleDragEnd);
        panel.addEventListener('dragover', handleDragOver);
        panel.addEventListener('dragleave', handleDragLeave);
        panel.addEventListener('drop', handleDrop);
        panel.querySelector('.play-btn').addEventListener('click', handlePlayClick);
        panel.querySelector('.remove-btn').addEventListener('click', handleRemoveClick);
        const minGoal = panel.querySelector('.min-goal');
        minGoal.value = localStorage.getItem(`goal-min-${type}`) || '';
        minGoal.addEventListener('change', () => {
          localStorage.setItem(`goal-min-${type}`, minGoal.value);
          updateDisplay(type);
        });
        const maxGoal = panel.querySelector('.max-goal');
        maxGoal.value = localStorage.getItem(`goal-max-${type}`) || '';
        maxGoal.addEventListener('change', () => {
          localStorage.setItem(`goal-max-${type}`, maxGoal.value);
          updateDisplay(type);
        });
        const thumbsUpBtn = panel.querySelector('.thumbs-up');
        thumbsUpBtn.addEventListener('click', () => {
          thumbsUp[type] = (thumbsUp[type] || 0) + 1;
          const countUp = panel.querySelector('.thumbs-up .count');
          countUp.textContent = thumbsUp[type];
          saveData();
        });
        const thumbsDownBtn = panel.querySelector('.thumbs-down');
        thumbsDownBtn.addEventListener('click', () => {
          thumbsDown[type] = (thumbsDown[type] || 0) + 1;
          const countDown = panel.querySelector('.thumbs-down .count');
          countDown.textContent = thumbsDown[type];
          saveData();
        });
        notes[type] = localStorage.getItem(`notes-${type}`) || '';
      });
    }
    function updateThumbsDisplay(type) {
      const panel = document.querySelector(`.timer-panel[data-type="${type}"]`);
      if (!panel) return;
      const countUp = panel.querySelector('.thumbs-up .count');
      countUp.textContent = thumbsUp[type] || 0;
      const countDown = panel.querySelector('.thumbs-down .count');
      countDown.textContent = thumbsDown[type] || 0;
    }
    function updateAllThumbs() {
      timers.forEach(updateThumbsDisplay);
    }
    function formatTime(seconds) {
      const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
      const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
      const s = (seconds % 60).toString().padStart(2, '0');
      return `${h}:${m}:${s}`;
    }
    function updateDisplay(type) {
      const panel = document.querySelector(`.timer-panel[data-type="${type}"]`);
      if (!panel) return;
      const timeDisplay = panel.querySelector('.time');
      timeDisplay.textContent = formatTime(currentTimes[type] || 0);
      const minGoal = parseInt(panel.querySelector('.min-goal').value) || 0;
      const maxGoal = parseInt(panel.querySelector('.max-goal').value) || 0;
      const radial = panel.querySelector('.radial-progress');
      const circle = panel.querySelector('.circle');
      const mask = panel.querySelector('.mask');
      const currentSeconds = currentTimes[type] || 0;
      const currentMin = currentSeconds / 60;
      let target = maxGoal || minGoal || currentMin || 1;
      let progress = Math.min(currentMin / target, 1);
      let angle = progress * 360;
      let statusColor = '#eee';
      let maskColor = '#fff';
      if (minGoal || maxGoal) {
        radial.style.display = 'block';
        if (currentMin < minGoal) {
          statusColor = 'orange';
          maskColor = 'orange';
        } else if (maxGoal && currentMin > maxGoal) {
          statusColor = 'orange';
          maskColor = 'orange';
        } else {
          statusColor = 'green';
          maskColor = 'green';
        }
        circle.style.background = `conic-gradient(#007bff 0deg ${angle}deg, ${statusColor} ${angle}deg 360deg)`;
      } else {
        radial.style.display = 'none';
      }
      mask.style.backgroundColor = maskColor;
    }
    function updateAllDisplays() {
      timers.forEach(updateDisplay);
    }
    function updateNotesTitle() {
      const notesTitle = document.querySelector('.notes-title');
      if (!runningType) {
        notesTitle.textContent = 'Notes';
        return;
      }
      let sessionText = '';
      if (sessionStartTime) {
        const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
        sessionText = ` (${formatTime(elapsed)})`;
      }
      notesTitle.textContent = `Notes - ${runningType}${sessionText}`;
    }
    function saveNotes() {
      if (runningType) {
        const notesElem = document.querySelector('.notes');
        notes[runningType] = notesElem.innerHTML;
        localStorage.setItem(`notes-${runningType}`, notes[runningType]);
      }
    }
    function loadNotes(type) {
      const notesElem = document.querySelector('.notes');
      notesElem.innerHTML = notes[type] || localStorage.getItem(`notes-${type}`) || '';
    }
    function dismissInactivityModal() {
      if (inactivityModal) {
        inactivityModal.remove();
        inactivityModal = null;
      }
      if (autoStopInterval) {
        clearInterval(autoStopInterval);
        autoStopInterval = null;
      }
      inactivityPopupShown = false;
    }
    function showInactivityModal() {
      if (inactivityPopupShown || !runningType) return;
      const modalHTML = `
        <div id="inactivity-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;">
          <div style="background: white; padding: 20px; border-radius: 8px; text-align: center; max-width: 300px;">
            <h3 style="margin-top: 0;">Inactive for 15 minutes</h3>
            <p>Do you want to continue the ${runningType} timer?</p>
            <div id="countdown" style="font-size: 18px; font-weight: bold; margin: 10px 0;">05:00</div>
            <button id="continue-btn" style="margin: 5px; padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Continue</button>
            <button id="stop-btn" style="margin: 5px; padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">Stop</button>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', modalHTML);
      inactivityModal = document.getElementById('inactivity-modal');
      inactivityPopupShown = true;
      let timeLeft = 300;
      const updateCountdown = () => {
        const mins = Math.floor(timeLeft / 60).toString().padStart(2, '0');
        const secs = (timeLeft % 60).toString().padStart(2, '0');
        document.getElementById('countdown').textContent = `${mins}:${secs}`;
        timeLeft--;
        if (timeLeft < 0) {
          clearInterval(autoStopInterval);
          autoStop();
        }
      };
      autoStopInterval = setInterval(updateCountdown, 1000);
      updateCountdown();
      document.getElementById('continue-btn').addEventListener('click', handleContinue);
      document.getElementById('stop-btn').addEventListener('click', handleStop);
    }
    function handleContinue() {
      dismissInactivityModal();
      lastActivityTime = Date.now();
    }
    function handleStop() {
      const currentRunningType = runningType;
      dismissInactivityModal();
      stopTimer();
      showMessageModal(`Timer "${currentRunningType}" stopped due to inactivity.`);
    }
    function autoStop() {
      const currentRunningType = runningType;
      dismissInactivityModal();
      stopTimer();
      showMessageModal(`Timer "${currentRunningType}" automatically stopped due to prolonged inactivity.`);
    }
    function showMessageModal(message) {
      const msgHTML = `
        <div id="message-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;">
          <div style="background: white; padding: 20px; border-radius: 8px; text-align: center; max-width: 300px;">
            <p style="margin-top: 0;">${message}</p>
            <button id="ok-btn" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">OK</button>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', msgHTML);
      const msgModal = document.getElementById('message-modal');
      document.getElementById('ok-btn').addEventListener('click', () => {
        msgModal.remove();
      });
      setTimeout(() => {
        if (msgModal && msgModal.parentNode) {
          msgModal.remove();
        }
      }, 5000);
    }
    function stopTimer() {
      if (autoStopInterval) {
        clearInterval(autoStopInterval);
        autoStopInterval = null;
      }
      dismissInactivityModal();
      if (interval) {
        clearInterval(interval);
        interval = null;
      }
      sessionStartTime = null;
      saveNotes();
      runningType = null;
      updateNotesTitle();
      document.querySelectorAll('.timer-panel').forEach(panel => {
        panel.classList.remove('inactive');
      });
      document.querySelectorAll('.play-btn').forEach(btn => {
        btn.textContent = 'Play';
      });
    }
    function startTimer(type) {
      stopTimer();
      runningType = type;
      sessionStartTime = Date.now();
      loadNotes(type);
      updateNotesTitle();
      inactivityPopupShown = false;
      if (inactivityModal) {
        dismissInactivityModal();
      }
      lastActivityTime = Date.now();
      interval = setInterval(() => {
        currentTimes[type]++;
        updateDisplay(type);
        updateNotesTitle();
        saveData();
        if (!inactivityPopupShown && Date.now() - lastActivityTime > 900000) {
          showInactivityModal();
        }
      }, 1000);
      document.querySelectorAll('.timer-panel').forEach(panel => {
        panel.classList.add('inactive');
      });
      const activePanel = document.querySelector(`.timer-panel[data-type="${type}"]`);
      activePanel.classList.remove('inactive');
      const btn = activePanel.querySelector('.play-btn');
      btn.textContent = 'Pause';
    }
    function handlePlayClick(e) {
      const panel = e.target.closest('.timer-panel');
      const type = panel.dataset.type;
      if (runningType === type) {
        stopTimer();
      } else {
        startTimer(type);
      }
    }
    function handleAddTimer() {
      const input = document.getElementById('new-timer-name');
      const newName = input.value.trim();
      if (newName && !timers.includes(newName)) {
        timers.push(newName);
        currentTimes[newName] = 0;
        thumbsUp[newName] = 0;
        thumbsDown[newName] = 0;
        notes[newName] = '';
        saveTimers();
        saveData();
        renderTimers();
        input.value = '';
      } else if (timers.includes(newName)) {
        alert('A timer with this name already exists.');
      } else {
        alert('Please enter a valid name for the timer.');
      }
    }
    function handleRemoveClick(e) {
      const panel = e.target.closest('.timer-panel');
      const typeToRemove = panel.dataset.type;
      if (confirm(`Are you sure you want to remove the "${typeToRemove}" timer? This will also delete its saved data.`)) {
        if (runningType === typeToRemove) {
          stopTimer();
        }
        timers = timers.filter(t => t !== typeToRemove);
        delete currentTimes[typeToRemove];
        delete thumbsUp[typeToRemove];
        delete thumbsDown[typeToRemove];
        delete notes[typeToRemove];
        localStorage.removeItem(`goal-min-${typeToRemove}`);
        localStorage.removeItem(`goal-max-${typeToRemove}`);
        localStorage.removeItem(`notes-${typeToRemove}`);
        saveTimers();
        saveData();
        renderTimers();
      }
    }
    function handleDragStart(e) {
      if (!e.target.classList.contains('timer-panel')) return;
      draggedElement = e.target;
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/plain', e.target.dataset.type);
      setTimeout(() => {
        e.target.classList.add('dragging');
      }, 0);
    }
    function handleDragEnd(e) {
      if (!draggedElement) return;
      draggedElement.classList.remove('dragging');
      document.querySelectorAll('.drag-over-top, .drag-over-bottom').forEach(el => {
        el.classList.remove('drag-over-top', 'drag-over-bottom');
      });
      draggedElement = null;
    }
    function handleDragOver(e) {
      e.preventDefault();
      const targetElement = e.target.closest('.timer-panel');
      if (!targetElement || targetElement === draggedElement) return;
      document.querySelectorAll('.timer-panel').forEach(p => {
        if (p !== targetElement) p.classList.remove('drag-over-top', 'drag-over-bottom');
      });
      const rect = targetElement.getBoundingClientRect();
      const midY = rect.top + rect.height / 2;
      if (e.clientY < midY) {
        targetElement.classList.add('drag-over-top');
        targetElement.classList.remove('drag-over-bottom');
      } else {
        targetElement.classList.add('drag-over-bottom');
        targetElement.classList.remove('drag-over-top');
      }
    }
    function handleDragLeave(e) {
      const targetElement = e.target.closest('.timer-panel');
      if (targetElement) {
        targetElement.classList.remove('drag-over-top', 'drag-over-bottom');
      }
    }
    function handleDrop(e) {
      e.preventDefault();
      const targetElement = e.target.closest('.timer-panel');
      if (!targetElement || !draggedElement || targetElement === draggedElement) return;
      const draggedType = draggedElement.dataset.type;
      const targetType = targetElement.dataset.type;
      const isDroppingBelow = targetElement.classList.contains('drag-over-bottom');
      targetElement.classList.remove('drag-over-top', 'drag-over-bottom');
      const fromIndex = timers.indexOf(draggedType);
      let toIndex = timers.indexOf(targetType);
      if (fromIndex === -1 || toIndex === -1) return;
      const [movedItem] = timers.splice(fromIndex, 1);
      const adjustedToIndex = (fromIndex < toIndex) ? toIndex - 1 : toIndex;
      timers.splice(isDroppingBelow ? adjustedToIndex + 1 : adjustedToIndex, 0, movedItem);
      saveTimers();
      renderTimers();
    }
    function saveData() {
      localStorage.setItem('currentDate', currentDate);
      localStorage.setItem('currentTimes', JSON.stringify(currentTimes));
      localStorage.setItem('thumbsUp', JSON.stringify(thumbsUp));
      localStorage.setItem('thumbsDown', JSON.stringify(thumbsDown));
      localStorage.setItem('history', JSON.stringify(history));
    }
    function updateMargin() {
      const notesContainer = document.querySelector('.notes-container');
      const mainContent = document.querySelector('.add-timer-form');
      if (notesContainer && mainContent) {
        mainContent.style.marginTop = `${notesContainer.offsetHeight + 20}px`;
      }
    }
    window.inactivityTimerRemaining = function() {
      return (Date.now() - lastActivityTime) / 1000;
    };
    window.inactivityTestModeStart = function(thresholdMs = 900000, countdownMs = 300000) {
      if (!runningType) {
        console.log('Start a timer first.');
        return;
      }
      const nearThreshold = thresholdMs - countdownMs;
      lastActivityTime = Date.now() - nearThreshold;
      console.log(`Inactivity test mode started. Remaining to popup: ${countdownMs / 1000}s`);
    };
    window.inactivityTestModeEnd = function() {
      lastActivityTime = Date.now();
      console.log('Inactivity test mode ended. Activity reset.');
    };
    function init() {
      loadTimers();
      const today = new Date().toISOString().slice(0, 10);
      currentDate = localStorage.getItem('currentDate') || today;
      const savedTimes = JSON.parse(localStorage.getItem('currentTimes')) || {};
      const savedThumbsUp = JSON.parse(localStorage.getItem('thumbsUp')) || {};
      const savedThumbsDown = JSON.parse(localStorage.getItem('thumbsDown')) || {};
      history = JSON.parse(localStorage.getItem('history')) || [];
      if (currentDate !== today) {
        history.push({
          date: currentDate,
          times: { ...savedTimes },
          thumbsUp: { ...savedThumbsUp },
          thumbsDown: { ...savedThumbsDown }
        });
        if (history.length > 10) history.shift();
        currentTimes = {};
        thumbsUp = {};
        thumbsDown = {};
        currentDate = today;
      } else {
        currentTimes = savedTimes;
        thumbsUp = savedThumbsUp;
        thumbsDown = savedThumbsDown;
      }
      timers.forEach(type => {
        if (currentTimes[type] === undefined) {
          currentTimes[type] = 0;
        }
        if (thumbsUp[type] === undefined) {
          thumbsUp[type] = 0;
        }
        if (thumbsDown[type] === undefined) {
          thumbsDown[type] = 0;
        }
      });
      saveData();
      renderTimers();
      const notesElem = document.querySelector('.notes');
      notesElem.addEventListener('input', saveNotes);
      notesElem.addEventListener('paste', saveNotes);
      document.getElementById('add-timer-btn').addEventListener('click', handleAddTimer);
      updateNotesTitle();
      updateMargin();
      window.addEventListener('resize', updateMargin);
      const activityEvents = ['mousemove', 'mousedown', 'keydown', 'scroll', 'touchstart'];
      activityEvents.forEach(event => {
        document.addEventListener(event, () => {
          lastActivityTime = Date.now();
        }, true);
      });
    }
    init();
  </script>
</body>
</html>